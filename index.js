const _0x12fd51=_0x14db;(function(_0x393913,_0x23d27){const _0x53a312=_0x14db,_0xb6f501=_0x393913();while(!![]){try{const _0x2b9788=parseInt(_0x53a312(0x121))/0x1+-parseInt(_0x53a312(0x11a))/0x2*(-parseInt(_0x53a312(0x111))/0x3)+parseInt(_0x53a312(0x15b))/0x4*(parseInt(_0x53a312(0x176))/0x5)+-parseInt(_0x53a312(0x156))/0x6+-parseInt(_0x53a312(0x11e))/0x7*(parseInt(_0x53a312(0x146))/0x8)+-parseInt(_0x53a312(0x157))/0x9*(parseInt(_0x53a312(0x112))/0xa)+-parseInt(_0x53a312(0x184))/0xb;if(_0x2b9788===_0x23d27)break;else _0xb6f501['push'](_0xb6f501['shift']());}catch(_0x13003a){_0xb6f501['push'](_0xb6f501['shift']());}}}(_0x5924,0x8a10e));function hi(){const _0x482ffb=_0x14db;console[_0x482ffb(0x125)]('Hello\x20World!');}hi();const {Server,ServerEvent}=require(_0x12fd51(0x16c)),WebSocket=require('ws'),fetch=require('node-fetch'),wanakana=require('wanakana'),fs=require('fs'),JSON5=require(_0x12fd51(0x14c)),configPath=_0x12fd51(0x103);let configFile=fs['readFileSync'](configPath,_0x12fd51(0x12f));const config=JSON5[_0x12fd51(0x120)](configFile);let {app_id,secret_key,username,sub_domain,proximity,spectator,password,distance,port,web_port,lang}=config,stop_roop=![],passwords={},positions={},shouldBroadcast=![],relayWs,mainWorld,localTcpClient;const RELAY_SERVER_DOMAIN=_0x12fd51(0x17d);function broadcastPositions(){const _0x3b99d9=_0x12fd51;if(relayWs&&relayWs['readyState']===WebSocket[_0x3b99d9(0x134)]){const _0x3ad5ab=JSON['stringify']({'type':_0x3b99d9(0x18a),'payload':{'positions':positions,'distance':distance,'password':password,'passwords':passwords,'app_id':app_id,'secret_key':secret_key}});relayWs[_0x3b99d9(0x169)](_0x3ad5ab);}}function _0x14db(_0x52d71d,_0x6cd9cb){const _0x592428=_0x5924();return _0x14db=function(_0x14db6d,_0x8a16fe){_0x14db6d=_0x14db6d-0x101;let _0x32df34=_0x592428[_0x14db6d];return _0x32df34;},_0x14db(_0x52d71d,_0x6cd9cb);}function processName(_0x3c89f6){const _0x5819a7=_0x12fd51,_0x5a2737=_0x3c89f6[_0x5819a7(0x17c)](/ /g,'_'),_0x324877=wanakana[_0x5819a7(0x149)](_0x5a2737);return _0x324877[_0x5819a7(0x17c)](/n'/g,'n');}async function handleWorld(_0x4be4ae){const _0x576ad4=_0x12fd51;try{const _0x4a8292=_0x4be4ae[_0x576ad4(0x16f)],_0x2a64af=Array['from'](_0x4a8292['values']())['map'](_0x20f7f8=>String(_0x20f7f8[_0x576ad4(0x186)]));if(proximity){const [_0x1f5dcb,_0x76ba83,_0x2be622]=await Promise[_0x576ad4(0x14b)]([_0x4be4ae[_0x576ad4(0x116)](_0x576ad4(0x15e)),_0x4be4ae['runCommand'](_0x576ad4(0x175)),_0x4be4ae[_0x576ad4(0x116)](_0x576ad4(0x178))]),_0x3eba6e=_0x1f5dcb[_0x576ad4(0x137)]||[],_0xd5cae8=_0x76ba83[_0x576ad4(0x137)]||[],_0x5091eb=_0x2be622[_0x576ad4(0x168)]||'[]',_0x2064b6=JSON[_0x576ad4(0x120)](_0x5091eb);_0x2a64af[_0x576ad4(0x113)]((_0x30a07d,_0x362654)=>{const _0x38fa4f=_0x576ad4,_0x50fa4c=processName(_0x30a07d);if(!_0x3eba6e[_0x38fa4f(0x161)](_0x30a07d))positions[_0x50fa4c]={'x':0x0,'y':0x4e20,'z':0x0};else{if(spectator&&_0xd5cae8[_0x38fa4f(0x161)](_0x30a07d))positions[_0x50fa4c]={'x':0x0,'y':0x2710,'z':0x0};else{if(_0x2064b6[_0x362654]&&_0x2064b6[_0x362654]['position']){const _0x3b3028=_0x2064b6[_0x362654][_0x38fa4f(0x162)];positions[_0x50fa4c]={'x':_0x3b3028['x'],'y':_0x3b3028['y'],'z':_0x3b3028['z']};}else console['warn']('Player\x20'+_0x30a07d+_0x38fa4f(0x128)+_0x362654+_0x38fa4f(0x126)),positions[_0x50fa4c]={'x':0x0,'y':0x7530,'z':0x0};}}}),shouldBroadcast=!![];}else _0x2a64af[_0x576ad4(0x113)](_0x55c042=>{positions[processName(_0x55c042)]={'x':0x0,'y':0x2710,'z':0x0};}),shouldBroadcast=!![];}catch(_0x88f0c1){console['error'](_0x576ad4(0x131),_0x88f0c1);}!stop_roop&&setTimeout(()=>handleWorld(_0x4be4ae),0x64);}function server_log_info(_0x3d3be8){const _0xccabe=_0x12fd51;console[_0xccabe(0x125)](_0xccabe(0x177)+_0x3d3be8);}function _0x5924(){const _0x3b03c8=['6688440KmFyfK','サーバーエラー:\x20','name','!pvc\x20true','\x20{\x22rawtext\x22:[{\x22text\x22:\x22ホスト専用コマンド：\x0a\x20\x20!lang\x20-\x20!lang\x20<ja/en>\x20chenge\x20language\x0a\x20\x20!dis\x20-\x20!dis\x20<数値>\x20で声の届く距離を変更できます\x0a\x20\x20!pvc\x20-\x20!pvc\x20<true/false>\x20で近接vcを有効/無効にできます\x0a\x20\x20!spectator\x20-\x20!spectator\x20<true/false>\x20でスペクテイターとVCを分けます\x0a\x20\x20!password\x20-\x20!password\x20<true/false>\x20でパスワードを有効/無効にできます\x22}]}','string','world_update','https://','\x0a声の届く距離：','\x0a!help\x20でコマンド一覧を確認できます','中継サーバーに新しいルームの作成をリクエストします...','./config.json','open','localPlayer','/create-room','action','https://proximity-vc-mcbe.pages.dev?roomid=','stringify','tellraw\x20','WorldRemove','values','!lang\x20en','enabled','\x20{\x22rawtext\x22:[{\x22text\x22:\x22Host-only\x20command：\x0a\x20\x20!lang\x20-\x20!lang\x20<ja/en>\x20言語を変更できます\x0a\x20\x20!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20\x20!pvc\x20-\x20!pvc\x20<true/false>\x20enable/disable\x20proximity\x20voice\x20chat\x0a\x20\x20!spectator\x20-\x20!spectator\x20<true/false>\x20separate\x20spectator\x20and\x20VC\x0a\x20\x20!password\x20-\x20!password\x20<true/false>\x20enable/disable\x20password\x22}]}','writeFileSync','33RMRyVS','60PCshyd','forEach','connection\x20closed:\x20','tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22スペクテイターとVCを分けました\x22}]}','runCommand','tellraw\x20\x22','roomId','\x20{\x22rawtext\x22:[{\x22text\x22:\x22Command\x20list:\x0a\x20\x20!help\x20-\x20show\x20help\x0a\x20\x20!name\x20-\x20check\x20your\x20VC\x20name\x22}]}','139604rMKJrw','ROOM\x20ID:\x20','Participants\x20should\x20access\x20this\x20URL','close','3207253SYvSPp','!password\x20false','parse','966269WYnSdy','startsWith','ルームの作成または接続に失敗しました:','\x22\x20{\x22rawtext\x22:[{\x22text\x22:\x22RoomID\x20is\x20','log',')\x20is\x20alive\x20and\x20not\x20spectator,\x20but\x20position\x20data\x20is\x20missing\x20or\x20invalid.\x20Defaulting.','[MC\x20Relay]\x20中継サーバーに接続完了(ID:\x20','\x20(index\x20','tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22近接vcを有効にしました\x22}]}','\x0aYour\x20VCname\x20is\x20','tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22スペクテイターを共通のVCにしました\x22}]}','!name','\x22}]}','tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22proximity\x20voice\x20chat\x20enabled\x22}]}','utf8','WorldAdd','Error\x20handling\x20world:','中継サーバーに接続しました。ブラウザからの指示を待っています...','command_result','OPEN','?clientType=binder_script','run_command','victim','受信したメッセージの解析またはコマンド実行に失敗:','Minecraftコマンドを実行します:\x20','Minecraft:\x20\x22/connect\x20localhost:','です\x22}]}','statusText','!spectator\x20false','Joined:\x20','[MC\x20Relay]\x20中継サーバーとの接続が切れました。','tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22近接vcを無効にしました\x22}]}','tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22Spectator\x20set\x20to\x20common\x20VC\x22}]}','PlayerJoin','=======================================================\x0a','tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22proximity\x20voice\x20chat\x20disabled\x22}]}','readyState','8HWisZP','tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22Password\x20enabled\x22}]}','\x22password\x22:\x20true','toRomaji','\x22\x20{\x22rawtext\x22:[{\x22text\x22:\x22ルームIDは','all','json5','\x22distance\x22:\x20','ブラウザからメッセージを受信:\x20','Connection\x20started\x0aProximity\x20voice\x20chat:','\x20{\x22rawtext\x22:[{\x22text\x22:\x22--------------------\x22}]}','接続を開始しました\x0a近接vc：','\x0a!help\x20for\x20command\x20list','tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22声の最大距離を','[MC\x20Relay]\x20Minecraft接続用の中継サーバーにルーム作成をリクエストします...','/connect\x20','3697830DVNOmi','922068FKqwcz','\x22\x20で接続します','[MC\x20Local\x20WS\x20Error]','中継サーバーとの接続が切れました。','4JSqMgP','Left:\x20','tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22パスワードを無効にしました\x22}]}','testfor\x20@e[type=player]','!password\x20true',')。パートナー(Minecraft)の参加を待っています...','includes','position','value','Open','[MC\x20Relay]\x20WebSocketエラー:','に変更しました\x22}]}','\x22\x20{\x22rawtext\x22:[{\x22text\x22:\x22Password\x20is\x20','details','send','PlayerLeave','\x20{\x22rawtext\x22:[{\x22text\x22:\x22コマンド一覧：\x0a\x20\x20!help\x20-\x20ヘルプを表示します\x0a\x20\x20!name\x20-\x20VCで使う名前を確認できます\x22}]}','socket-be','type','\x22spectator\x22:\x20false','players','tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22<Proximity\x20VC>Language\x20set\x20to\x20English\x22}]}','error','map','!pvc\x20false','WebSocketエラー:','testfor\x20@a[m=spectator]','5643315ettcDW','\x1b[36m[Info]\x1b[0m\x20','querytarget\x20@a','/room/','\x0a=======================================================','!dis\x20','replace','mcproxvc.tcpexposer.com','distance\x20=\x20','\x22password\x22:\x20false','tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22Password\x20disabled\x22}]}','sendMessage','\x1b[33m[Log]\x1b[0m\x20','message'];_0x5924=function(){return _0x3b03c8;};return _0x5924();}function server_log_log(_0x56fc74){const _0x1ab4f8=_0x12fd51;console['log'](_0x1ab4f8(0x182)+_0x56fc74);}function periodicBroadcast(){shouldBroadcast&&(broadcastPositions(),shouldBroadcast=![]),setTimeout(periodicBroadcast,0x32);}const server=new Server({'port':port,'disableEncryption':!![],'timezone':'Asia/Tokyo'});server['on'](ServerEvent['PlayerChat'],async _0x37cb04=>{const _0x6cb157=_0x12fd51,{sender:_0x1b7b76,message:_0x4a866d,world:_0x3db138}=_0x37cb04;if(_0x4a866d==='!test'){const _0x31dff0=_0x3db138[_0x6cb157(0x16f)],_0x4daee2=Array['from'](_0x31dff0[_0x6cb157(0x10c)]())[_0x6cb157(0x172)](_0x1d0ef4=>_0x1d0ef4[_0x6cb157(0x186)]);console['log'](Array['from'](_0x31dff0[_0x6cb157(0x10c)]())[_0x6cb157(0x172)](_0x4b1fa6=>_0x4b1fa6));}if(_0x4a866d[_0x6cb157(0x122)](_0x6cb157(0x17b))){dis=_0x4a866d['split']('\x20');if(!isNaN(dis[0x1])){const _0x25f130=_0x3db138['localPlayer']['name'];_0x1b7b76[_0x6cb157(0x186)]==_0x25f130&&(distance=Number(dis[0x1]),configFile=configFile[_0x6cb157(0x17c)](/"distance":\s*[\d.]+/,_0x6cb157(0x14d)+distance),fs['writeFileSync'](configPath,configFile,_0x6cb157(0x12f)),lang=='ja'?await _0x3db138['runCommand'](_0x6cb157(0x153)+distance+_0x6cb157(0x166)):await _0x3db138[_0x6cb157(0x116)]('tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22Changed\x20max\x20distance\x20to\x20'+distance+_0x6cb157(0x12d)));}console[_0x6cb157(0x125)](_0x6cb157(0x17e)+distance);}else{if(_0x4a866d===_0x6cb157(0x12c)){const _0x2ca702=_0x1b7b76[_0x6cb157(0x186)][_0x6cb157(0x17c)](/ /g,'_');senderName=wanakana['toRomaji'](_0x2ca702);let _0x56e054=senderName['replace'](/n'/g,'n');console['log'](_0x56e054);lang=='ja'?await _0x3db138[_0x6cb157(0x116)]('tellraw\x20\x22'+_0x1b7b76[_0x6cb157(0x186)]+_0x6cb157(0x14a)+sub_domain+'です\x0aあなたのVCnameは'+_0x56e054+_0x6cb157(0x13b)):await _0x3db138['runCommand'](_0x6cb157(0x117)+_0x1b7b76[_0x6cb157(0x186)]+_0x6cb157(0x124)+sub_domain+_0x6cb157(0x12a)+_0x56e054+_0x6cb157(0x12d));if(password){if(!passwords[_0x56e054]){let _0x539006='';const _0x34eb24='0123456789';for(let _0x4ed001=0x0;_0x4ed001<0x4;_0x4ed001++){const _0x4def41=Math['floor'](Math['random']()*_0x34eb24['length']);_0x539006+=_0x34eb24[_0x4def41];}passwords[_0x56e054]=_0x539006;}lang=='ja'?await _0x3db138['runCommand']('tellraw\x20\x22'+_0x1b7b76[_0x6cb157(0x186)]+'\x22\x20{\x22rawtext\x22:[{\x22text\x22:\x22パスワードは'+passwords[_0x56e054]+'です\x22}]}'):await _0x3db138[_0x6cb157(0x116)]('tellraw\x20\x22'+_0x1b7b76[_0x6cb157(0x186)]+_0x6cb157(0x167)+passwords[_0x56e054]+'\x22}]}');}}else{if(_0x4a866d===_0x6cb157(0x15f)){const _0x5cd0c8=_0x3db138[_0x6cb157(0x105)][_0x6cb157(0x186)];_0x1b7b76[_0x6cb157(0x186)]==_0x5cd0c8&&(password=!![],configFile=configFile[_0x6cb157(0x17c)](/"password": false/,_0x6cb157(0x148)),fs[_0x6cb157(0x110)](configPath,configFile,_0x6cb157(0x12f)),lang=='ja'?await _0x3db138[_0x6cb157(0x116)]('tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22パスワードを有効にしました\x22}]}'):await _0x3db138[_0x6cb157(0x116)](_0x6cb157(0x147)));}else{if(_0x4a866d===_0x6cb157(0x11f)){const _0x385044=_0x3db138['localPlayer'][_0x6cb157(0x186)];_0x1b7b76[_0x6cb157(0x186)]==_0x385044&&(password=![],configFile=configFile[_0x6cb157(0x17c)](/"password": true/,_0x6cb157(0x17f)),fs[_0x6cb157(0x110)](configPath,configFile,_0x6cb157(0x12f)),lang=='ja'?await _0x3db138['runCommand'](_0x6cb157(0x15d)):await _0x3db138[_0x6cb157(0x116)](_0x6cb157(0x180)));}else{if(_0x4a866d===_0x6cb157(0x187)){const _0x1a1c66=_0x3db138[_0x6cb157(0x105)][_0x6cb157(0x186)];_0x1b7b76[_0x6cb157(0x186)]==_0x1a1c66&&(proximity=!![],configFile=configFile[_0x6cb157(0x17c)](/"proximity": false/,'\x22proximity\x22:\x20true'),fs['writeFileSync'](configPath,configFile,_0x6cb157(0x12f)),lang=='ja'?await _0x3db138[_0x6cb157(0x116)](_0x6cb157(0x129)):await _0x3db138[_0x6cb157(0x116)](_0x6cb157(0x12e)));}else{if(_0x4a866d===_0x6cb157(0x173)){const _0x72522b=_0x3db138[_0x6cb157(0x105)]['name'];_0x1b7b76['name']==_0x72522b&&(proximity=![],configFile=configFile['replace'](/"proximity": true/,'\x22proximity\x22:\x20false'),fs['writeFileSync'](configPath,configFile,_0x6cb157(0x12f)),lang=='ja'?await _0x3db138[_0x6cb157(0x116)](_0x6cb157(0x140)):await _0x3db138[_0x6cb157(0x116)](_0x6cb157(0x144)));}else{if(_0x4a866d==='!spectator\x20true'){const _0x107ae5=_0x3db138[_0x6cb157(0x105)]['name'];_0x1b7b76[_0x6cb157(0x186)]==_0x107ae5&&(proximity=!![],configFile=configFile[_0x6cb157(0x17c)](/"spectator": false/,'\x22spectator\x22:\x20true'),fs[_0x6cb157(0x110)](configPath,configFile,_0x6cb157(0x12f)),lang=='ja'?await _0x3db138['runCommand'](_0x6cb157(0x115)):await _0x3db138[_0x6cb157(0x116)]('tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22Spectator\x20and\x20VC\x20separated\x22}]}'));}else{if(_0x4a866d===_0x6cb157(0x13d)){const _0x5723e0=_0x3db138[_0x6cb157(0x105)][_0x6cb157(0x186)];_0x1b7b76[_0x6cb157(0x186)]==_0x5723e0&&(proximity=![],configFile=configFile[_0x6cb157(0x17c)](/"spectator": true/,_0x6cb157(0x16e)),fs[_0x6cb157(0x110)](configPath,configFile,_0x6cb157(0x12f)),lang=='ja'?await _0x3db138[_0x6cb157(0x116)](_0x6cb157(0x12b)):await _0x3db138[_0x6cb157(0x116)](_0x6cb157(0x141)));}else{if(_0x4a866d==='!lang\x20ja'){const _0x14dc5a=_0x3db138[_0x6cb157(0x105)][_0x6cb157(0x186)];_0x1b7b76[_0x6cb157(0x186)]==_0x14dc5a&&(lang='ja',configFile=configFile[_0x6cb157(0x17c)](/"lang": "en"/,'\x22lang\x22:\x20\x22ja\x22'),fs[_0x6cb157(0x110)](configPath,configFile,_0x6cb157(0x12f)),await _0x3db138[_0x6cb157(0x116)]('tellraw\x20@a\x20{\x22rawtext\x22:[{\x22text\x22:\x22<近接VC>言語を日本語に設定しました\x22}]}'));}else{if(_0x4a866d===_0x6cb157(0x10d)){const _0x2a6eba=_0x3db138['localPlayer']['name'];_0x1b7b76[_0x6cb157(0x186)]==_0x2a6eba&&(lang='en',configFile=configFile[_0x6cb157(0x17c)](/"lang": "ja"/,'\x22lang\x22:\x20\x22en\x22'),fs[_0x6cb157(0x110)](configPath,configFile,_0x6cb157(0x12f)),await _0x3db138[_0x6cb157(0x116)](_0x6cb157(0x170)));}else{if(_0x4a866d==='!help'){await _0x3db138[_0x6cb157(0x116)](_0x6cb157(0x10a)+_0x1b7b76[_0x6cb157(0x186)]+_0x6cb157(0x150));if(lang=='ja'){await _0x3db138[_0x6cb157(0x116)]('tellraw\x20'+_0x1b7b76[_0x6cb157(0x186)]+_0x6cb157(0x16b));const _0x264cbc=_0x3db138['localPlayer']['name'];_0x1b7b76['name']==_0x264cbc&&await _0x3db138[_0x6cb157(0x116)](_0x6cb157(0x10a)+_0x1b7b76[_0x6cb157(0x186)]+_0x6cb157(0x188));}else{await _0x3db138['runCommand'](_0x6cb157(0x10a)+_0x1b7b76[_0x6cb157(0x186)]+_0x6cb157(0x119));const _0x3c88b3=_0x3db138[_0x6cb157(0x105)][_0x6cb157(0x186)];_0x1b7b76[_0x6cb157(0x186)]==_0x3c88b3&&await _0x3db138[_0x6cb157(0x116)](_0x6cb157(0x10a)+_0x1b7b76[_0x6cb157(0x186)]+_0x6cb157(0x10f));}await _0x3db138[_0x6cb157(0x116)]('tellraw\x20'+_0x1b7b76[_0x6cb157(0x186)]+_0x6cb157(0x150));}}}}}}}}}}}}),server['on'](ServerEvent[_0x12fd51(0x164)],()=>{const _0x367dc5=_0x12fd51;server_log_info(_0x367dc5(0x13a)+port+_0x367dc5(0x158)),server_log_log(_0x367dc5(0x104));}),server['on'](ServerEvent[_0x12fd51(0x130)],async _0x176523=>{const _0x486c8e=_0x12fd51,{world:_0x1cce7f}=_0x176523;server_log_info('connection\x20opened:\x20'+_0x1cce7f['name']);if(lang=='ja'){let _0x57bee9='';proximity?_0x57bee9='有効':_0x57bee9='無効',_0x1cce7f[_0x486c8e(0x181)](_0x486c8e(0x151)+_0x57bee9+_0x486c8e(0x18c)+distance+_0x486c8e(0x101));}else{let _0x3db7e0='';proximity?_0x3db7e0=_0x486c8e(0x10e):_0x3db7e0='disabled',_0x1cce7f['sendMessage'](_0x486c8e(0x14f)+_0x3db7e0+'\x0aMax\x20distance:'+distance+_0x486c8e(0x152));}await handleWorld(_0x1cce7f);}),server['on'](ServerEvent[_0x12fd51(0x10b)],_0x571672=>{const _0x356286=_0x12fd51,{world:_0x397064}=_0x571672;stop_roop=!![],server_log_info(_0x356286(0x114)+_0x397064['name']);}),server['on'](ServerEvent[_0x12fd51(0x142)],_0x1bf061=>{const _0x35f754=_0x12fd51,{player:_0x3c6055}=_0x1bf061;server_log_info(_0x35f754(0x13e)+_0x3c6055[_0x35f754(0x186)]);}),server['on'](ServerEvent[_0x12fd51(0x16a)],async _0x8ee269=>{const _0x371162=_0x12fd51,{player:_0x4c3cfa}=_0x8ee269;server_log_info(_0x371162(0x15c)+_0x4c3cfa[_0x371162(0x186)]),positions[_0x4c3cfa[_0x371162(0x186)]]={'x':0x0,'y':0x2710,'z':0x0};});async function connectToRelayServer(){const _0x43fe9c=_0x12fd51;console['log'](_0x43fe9c(0x102));try{const _0x581b93=await fetch(_0x43fe9c(0x18b)+RELAY_SERVER_DOMAIN+_0x43fe9c(0x106));if(!_0x581b93['ok'])throw new Error(_0x43fe9c(0x185)+_0x581b93[_0x43fe9c(0x13c)]);const _0x5f3408=await _0x581b93['json'](),_0x1429a5=_0x5f3408[_0x43fe9c(0x118)];console[_0x43fe9c(0x125)]('\x0a======================================================='),console[_0x43fe9c(0x125)](_0x43fe9c(0x11b)+_0x1429a5),console[_0x43fe9c(0x125)]('参加者はこのURLにアクセスしてください'),console['log'](_0x43fe9c(0x11c)),console[_0x43fe9c(0x125)](_0x43fe9c(0x108)+_0x1429a5),console[_0x43fe9c(0x125)](_0x43fe9c(0x143));const _0x243fd3='wss://'+RELAY_SERVER_DOMAIN+_0x43fe9c(0x179)+_0x1429a5+_0x43fe9c(0x135);relayWs=new WebSocket(_0x243fd3),relayWs['on']('open',()=>{const _0x127012=_0x43fe9c;console[_0x127012(0x125)](_0x127012(0x132));}),relayWs['on'](_0x43fe9c(0x183),async _0x37dd14=>{const _0x2d77a6=_0x43fe9c,_0x1ba66c=_0x37dd14['toString']();console[_0x2d77a6(0x125)](_0x2d77a6(0x14e)+_0x1ba66c);try{const _0x5b8d9b=JSON[_0x2d77a6(0x120)](_0x1ba66c);if(mainWorld&&_0x5b8d9b[_0x2d77a6(0x107)]===_0x2d77a6(0x136)&&typeof _0x5b8d9b[_0x2d77a6(0x163)]===_0x2d77a6(0x189)){console[_0x2d77a6(0x125)](_0x2d77a6(0x139)+_0x5b8d9b[_0x2d77a6(0x163)]);const _0x120398=await mainWorld[_0x2d77a6(0x116)](_0x5b8d9b[_0x2d77a6(0x163)]);relayWs[_0x2d77a6(0x169)](JSON[_0x2d77a6(0x109)]({'type':_0x2d77a6(0x133),'payload':_0x120398}));}}catch(_0x5a9d92){console['error'](_0x2d77a6(0x138),_0x5a9d92);}}),relayWs['on'](_0x43fe9c(0x11d),()=>console['log'](_0x43fe9c(0x15a))),relayWs['on'](_0x43fe9c(0x171),_0x382f56=>console[_0x43fe9c(0x171)](_0x43fe9c(0x174),_0x382f56));}catch(_0x58c231){console[_0x43fe9c(0x171)](_0x43fe9c(0x123),_0x58c231);}}async function connectMcToServerRelay(){const _0x1e35f8=_0x12fd51;console[_0x1e35f8(0x125)](_0x1e35f8(0x154));try{const _0x340e60=await fetch(_0x1e35f8(0x18b)+RELAY_SERVER_DOMAIN+_0x1e35f8(0x106)),_0x2278b6=await _0x340e60['json'](),_0x3fbc16=_0x2278b6[_0x1e35f8(0x118)];console[_0x1e35f8(0x125)](_0x1e35f8(0x17a)),console[_0x1e35f8(0x125)]('Minecraftから以下のコマンドで接続してください:'),console['log']('Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:'),console[_0x1e35f8(0x125)](_0x1e35f8(0x155)+RELAY_SERVER_DOMAIN+_0x1e35f8(0x179)+_0x3fbc16),console[_0x1e35f8(0x125)]('=======================================================\x0a');const _0x193649='wss://'+RELAY_SERVER_DOMAIN+_0x1e35f8(0x179)+_0x3fbc16+_0x1e35f8(0x135),_0x104aba=new WebSocket(_0x193649);_0x104aba['on']('open',()=>{const _0x4f5e20=_0x1e35f8;console[_0x4f5e20(0x125)](_0x4f5e20(0x127)+_0x3fbc16+_0x4f5e20(0x160));}),_0x104aba['on'](_0x1e35f8(0x183),_0x11245f=>{const _0x104dbc=_0x1e35f8;try{const _0x211135=JSON[_0x104dbc(0x120)](_0x11245f['toString']());if(_0x211135[_0x104dbc(0x16d)]==='partner_connected'){console[_0x104dbc(0x125)]('★★★\x20[MC\x20Relay]\x20パートナー接続通知を受信。ローカルブリッジを構築します。\x20★★★');const _0x21d314=_0x104aba,_0x31e7ea=new WebSocket('ws://127.0.0.1:'+port);localTcpClient=_0x31e7ea,_0x31e7ea['on'](_0x104dbc(0x104),()=>console[_0x104dbc(0x125)]('[MC\x20Relay]\x20ローカルのsocket-beに接続成功。')),_0x31e7ea['on'](_0x104dbc(0x183),_0x235cca=>{const _0x20c46c=_0x104dbc;if(_0x21d314[_0x20c46c(0x145)]===WebSocket[_0x20c46c(0x134)])_0x21d314[_0x20c46c(0x169)](_0x235cca);}),_0x31e7ea['on'](_0x104dbc(0x171),_0x2114da=>console[_0x104dbc(0x171)](_0x104dbc(0x159),_0x2114da[_0x104dbc(0x183)])),_0x31e7ea['on']('close',()=>{const _0x155373=_0x104dbc;if(_0x21d314['readyState']===WebSocket[_0x155373(0x134)])_0x21d314[_0x155373(0x11d)]();});return;}}catch(_0x4ec331){}localTcpClient&&localTcpClient[_0x104dbc(0x145)]===WebSocket[_0x104dbc(0x134)]&&localTcpClient['send'](_0x11245f);}),_0x104aba['on'](_0x1e35f8(0x11d),()=>{const _0x344613=_0x1e35f8;console[_0x344613(0x125)](_0x344613(0x13f));if(localTcpClient)localTcpClient[_0x344613(0x11d)]();}),_0x104aba['on'](_0x1e35f8(0x171),_0xa58102=>console['error'](_0x1e35f8(0x165),_0xa58102));}catch(_0x3ba1b9){console['error']('[MC]\x20処理中にエラーが発生しました:',_0x3ba1b9);}}periodicBroadcast(),connectMcToServerRelay(),connectToRelayServer();